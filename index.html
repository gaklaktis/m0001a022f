<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ –ú–∞—Ñ–∏–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 10px;
        }
        
        .container {
            max-width: 100%;
            overflow-x: auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            font-size: 12px;
        }
        
        th, td {
            padding: 6px 3px;
            text-align: center;
            border: 1px solid #e0e0e0;
            min-width: 40px;
        }
        
        th {
            background: #2196F3;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .editable {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .editable:hover {
            background-color: #e3f2fd !important;
        }
        
        .add-row {
            background: #4CAF50 !important;
            color: white;
        }
        
        .save-btn {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 10px;
        }
        
        .save-btn:hover {
            background: #45a049;
        }
        
        .save-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .save-btn.saved {
            background: #2E7D32;
        }
        
        .refresh-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .refresh-btn:hover {
            background: #1976D2;
        }
        
        .refresh-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 300px;
        }
        
        .modal input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .confirm-btn {
            background: #4CAF50;
            color: white;
        }
        
        .cancel-btn {
            background: #f44336;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            color: #f44336;
            background: #ffebee;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
            color: #856404;
        }
        
        .test-data-panel {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .test-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }
        
        .confirmation-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 300px;
            text-align: center;
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .confirmation-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .confirm-yes {
            background: #4CAF50;
            color: white;
        }
        
        .confirm-no {
            background: #f44336;
            color: white;
        }
        
        .status-indicator {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }
        
        .status-saved {
            background: #4CAF50;
            color: white;
        }
        
        .status-unsaved {
            background: #ff9800;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>üèÜ –†–µ–π—Ç–∏–Ω–≥ –ú–∞—Ñ–∏–∏ üèÜ</h2>
            <div class="header-controls">
                <span id="edit-mode" style="color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                <button id="refresh-btn" class="refresh-btn" style="display: none;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                <span id="status-indicator" class="status-indicator" style="display: none;"></span>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ -->
        <div id="debug-info" class="debug-info" style="display: none;">
            <strong>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong>
            <div id="debug-content"></div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏) -->
        <div id="test-panel" class="test-data-panel" style="display: none;">
            <strong>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):</strong><br>
            <button class="test-btn" onclick="loadTestData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button class="test-btn" onclick="simulateSave()">–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</button>
            <button class="test-btn" onclick="checkInitData()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å InitData</button>
        </div>
        
        <div id="loading" class="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        </div>
        
        <div id="error-message" class="error" style="display: none;">
            –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        </div>
        
        <table id="rating-table" style="display: none;">
            <thead>
                <tr>
                    <th>–ú–µ—Å—Ç–æ</th>
                    <th>–ù–∏–∫</th>
                    <th>–ò–≥—Ä—ã</th>
                    <th>–ú–∏—Ä–Ω—ã–π</th>
                    <th>–ú–∞—Ñ–∏—è</th>
                    <th>–î–æ–Ω</th>
                    <th>–õ—é–±–æ–≤–Ω–∏—Ü–∞</th>
                    <th>–®–µ—Ä–∏—Ñ</th>
                    <th>–î–æ–∫—Ç–æ—Ä</th>
                    <th>–ú–∞–Ω—å—è–∫</th>
                    <th>–ö–∞–º–∏–∫–∞–¥–∑–µ</th>
                    <th>–ú—Å—Ç–∏—Ç–µ–ª—å</th>
                    <th>–û—á–∫–∏</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã JavaScript -->
            </tbody>
        </table>
        
        <button id="save-btn" class="save-btn" style="display: none;">
            üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø
        </button>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
            <input type="text" id="modal-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
            <div class="modal-buttons">
                <button class="modal-btn cancel-btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn confirm-btn" onclick="confirmEdit()">OK</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
    <div id="confirmation-modal" class="confirmation-modal">
        <div class="confirmation-content">
            <h3>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h3>
            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è?</p>
            <div class="confirmation-buttons">
                <button class="confirmation-btn confirm-no" onclick="closeConfirmation(false)">–û—Ç–º–µ–Ω–∞</button>
                <button class="confirmation-btn confirm-yes" onclick="closeConfirmation(true)">–î–∞</button>
            </div>
        </div>
    </div>
    
    <script>
        let tg = Telegram.WebApp;
        let players = [];
        let isEditMode = false;
        let isAdmin = false;
        let currentEdit = null;
        let hasChanges = false;
        let saveCallback = null;
        let lastDataHash = '';
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateDebugInfo(message) {
            const debugDiv = document.getElementById('debug-info');
            const debugContent = document.getElementById('debug-content');
            const timestamp = new Date().toLocaleTimeString();
            debugContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            debugDiv.style.display = 'block';
            console.log(`[DEBUG] ${message}`);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–∞–Ω–µ–ª–∏ –æ—Ç–ª–∞–¥–∫–∏
            const messages = debugContent.children;
            if (messages.length > 20) {
                debugContent.removeChild(messages[0]);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ InitData
        function checkInitData() {
            updateDebugInfo('=== –ü–†–û–í–ï–†–ö–ê TELEGRAM INIT DATA ===');
            updateDebugInfo(`–í–µ—Ä—Å–∏—è Telegram WebApp: ${tg.version}`);
            updateDebugInfo(`Platform: ${tg.platform}`);
            updateDebugInfo(`InitData: ${tg.initData}`);
            updateDebugInfo(`InitDataUnsafe: ${JSON.stringify(tg.initDataUnsafe)}`);
            
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                updateDebugInfo(`User ID: ${tg.initDataUnsafe.user.id}`);
                updateDebugInfo(`Is Admin: ${tg.initDataUnsafe.user.id === 7355212004}`);
            }
        }
        
        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π Telegram
        function showUniversalConfirm(title, message, callback) {
            updateDebugInfo('showUniversalConfirm –≤—ã–∑–≤–∞–Ω');
            
            // –í –≤–µ—Ä—Å–∏–∏ 6.0 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è showPopup, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            if (tg.version && parseFloat(tg.version) >= 6.2) {
                // –î–ª—è –≤–µ—Ä—Å–∏–π 6.2+ –∏—Å–ø–æ–ª—å–∑—É–µ–º showConfirm –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
                if (typeof tg.showConfirm === 'function') {
                    updateDebugInfo('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è tg.showConfirm');
                    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: showConfirm –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç boolean, –∞ –Ω–µ —Å—Ç—Ä–æ–∫—É
                    tg.showConfirm(message, function(result) {
                        updateDebugInfo(`–†–µ–∑—É–ª—å—Ç–∞—Ç showConfirm: ${result}`);
                        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º boolean –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                        callback(result ? 'yes' : null);
                    });
                    return;
                }
            }
            
            // –î–ª—è –≤–µ—Ä—Å–∏–π –Ω–∏–∂–µ 6.2 –∏–ª–∏ –µ—Å–ª–∏ showConfirm –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            updateDebugInfo('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
            saveCallback = callback;
            document.getElementById('confirmation-modal').style.display = 'flex';
        }
        
        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showUniversalAlert(message) {
            if (typeof tg.showAlert === 'function') {
                tg.showAlert(message);
            } else {
                // –ï—Å–ª–∏ showAlert –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–ª–∏ console.log
                console.log(`ALERT: ${message}`);
                updateDebugInfo(`ALERT: ${message}`);
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        function closeConfirmation(result) {
            document.getElementById('confirmation-modal').style.display = 'none';
            if (saveCallback) {
                updateDebugInfo(`–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: ${result}`);
                saveCallback(result ? 'yes' : null);
                saveCallback = null;
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
        function showTestPanel() {
            document.getElementById('test-panel').style.display = 'block';
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        function loadTestData() {
            updateDebugInfo('–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
            players = [
                {
                    place: 1,
                    nick: '–¢–µ—Å—Ç–æ–≤—ã–π –ò–≥—Ä–æ–∫ 1',
                    totalGames: 10,
                    totalPoints: 150,
                    –º–∏—Ä–Ω—ã–π: {o: 50, t: 5},
                    –º–∞—Ñ–∏—è: {o: 30, t: 2},
                    –¥–æ–Ω: {o: 20, t: 1},
                    –ª—é–±–æ–≤–Ω–∏—Ü–∞: {o: 10, t: 1},
                    —à–µ—Ä–∏—Ñ: {o: 15, t: 1},
                    –¥–æ–∫—Ç–æ—Ä: {o: 10, t: 0},
                    –º–∞–Ω—å—è–∫: {o: 10, t: 0},
                    –∫–∞–º–∏–∫–∞–¥–∑–µ: {o: 5, t: 0},
                    –º—Å—Ç–∏—Ç–µ–ª—å: {o: 0, t: 0}
                },
                {
                    place: 2,
                    nick: '–¢–µ—Å—Ç–æ–≤—ã–π –ò–≥—Ä–æ–∫ 2',
                    totalGames: 8,
                    totalPoints: 120,
                    –º–∏—Ä–Ω—ã–π: {o: 40, t: 4},
                    –º–∞—Ñ–∏—è: {o: 25, t: 2},
                    –¥–æ–Ω: {o: 15, t: 1},
                    –ª—é–±–æ–≤–Ω–∏—Ü–∞: {o: 10, t: 1},
                    —à–µ—Ä–∏—Ñ: {o: 20, t: 0},
                    –¥–æ–∫—Ç–æ—Ä: {o: 10, t: 0},
                    –º–∞–Ω—å—è–∫: {o: 0, t: 0},
                    –∫–∞–º–∏–∫–∞–¥–∑–µ: {o: 0, t: 0},
                    –º—Å—Ç–∏—Ç–µ–ª—å: {o: 0, t: 0}
                }
            ];
            isEditMode = true;
            isAdmin = true;
            updateDebugInfo(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${players.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤`);
            renderTable();
        }
        
        // –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function simulateSave() {
            updateDebugInfo('–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö...');
            document.getElementById('save-btn').click();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function forceRefreshData() {
            updateDebugInfo('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
            const refreshBtn = document.getElementById('refresh-btn');
            refreshBtn.textContent = 'üîÑ –û–ë–ù–û–í–õ–Ø–ï–ú...';
            refreshBtn.disabled = true;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            document.getElementById('loading').style.display = 'block';
            document.getElementById('rating-table').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            
            loadDataFromUrl();
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                refreshBtn.textContent = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å';
                refreshBtn.disabled = false;
            }, 3000);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        function updateStatusIndicator() {
            const indicator = document.getElementById('status-indicator');
            if (hasChanges) {
                indicator.textContent = '–ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                indicator.className = 'status-indicator status-unsaved';
                indicator.style.display = 'inline-block';
            } else {
                indicator.textContent = '–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
                indicator.className = 'status-indicator status-saved';
                indicator.style.display = 'inline-block';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        tg.expand();
        updateDebugInfo('WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        updateDebugInfo(`–í–µ—Ä—Å–∏—è Telegram WebApp: ${tg.version}`);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
        function loadDataFromUrl() {
            const params = new URLSearchParams(window.location.search);
            
            // –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            updateDebugInfo('=== –ê–ù–ê–õ–ò–ó –ü–ê–†–ê–ú–ï–¢–†–û–í URL ===');
            updateDebugInfo(`–ü–æ–ª–Ω—ã–π URL: ${window.location.href}`);
            updateDebugInfo(`–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞: ${window.location.search}`);
            
            const allParams = {};
            for (const [key, value] of params.entries()) {
                allParams[key] = value;
                updateDebugInfo(`–ü–∞—Ä–∞–º–µ—Ç—Ä: ${key} = ${value}`);
            }
            
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–º–µ–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
            let dataUrl = params.get('dataUrl') || 
                         params.get('dataurl') || 
                         params.get('dataURL');
            
            isAdmin = params.get('isAdmin') === 'true' || 
                     params.get('isadmin') === 'true';
                     
            isEditMode = (params.get('edit') === 'true') && isAdmin;
            
            updateDebugInfo(`–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π dataUrl: ${dataUrl}`);
            updateDebugInfo(`isAdmin: ${isAdmin}`);
            updateDebugInfo(`isEditMode: ${isEditMode}`);
            
            // –ï—Å–ª–∏ dataUrl –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –ø–∞–Ω–µ–ª—å
            if (!dataUrl) {
                updateDebugInfo('‚ùå dataUrl –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö URL');
                showTestPanel();
                
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ InitData –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const userId = tg.initDataUnsafe.user.id;
                    updateDebugInfo(`User ID –∏–∑ InitData: ${userId}`);
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
                    if (userId === 7355212004) {
                        isAdmin = true;
                        updateDebugInfo('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (–∏–∑ InitData)');
                    }
                }
            }
            
            if (dataUrl) {
                const decodedUrl = decodeURIComponent(dataUrl);
                updateDebugInfo(`–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π URL: ${decodedUrl}`);
                
                // –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
                const random = Math.random().toString(36).substring(7);
                const timestamp = Date.now();
                const urlWithCacheBust = `${decodedUrl}?t=${timestamp}&r=${random}&_=${random}`;
                
                updateDebugInfo(`URL —Å –∞–Ω—Ç–∏-–∫–µ—à–µ–º: ${urlWithCacheBust}`);
                
                fetch(urlWithCacheBust, {
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        updateDebugInfo(`‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ${data.length} –∏–≥—Ä–æ–∫–æ–≤`);
                        players = data;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
                        const newDataHash = JSON.stringify(data);
                        if (newDataHash !== lastDataHash) {
                            updateDebugInfo('üîç –î–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É');
                            lastDataHash = newDataHash;
                        } else {
                            updateDebugInfo('‚ÑπÔ∏è –î–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å');
                        }
                        
                        renderTable();
                    })
                    .catch(error => {
                        updateDebugInfo(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error}`);
                        showUniversalAlert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                        showTestPanel();
                        players = [];
                        renderTable();
                    });
            } else {
                updateDebugInfo('‚ùå URL –¥–∞–Ω–Ω—ã—Ö –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö');
                showUniversalAlert('URL –¥–∞–Ω–Ω—ã—Ö –Ω–µ —É–∫–∞–∑–∞–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.');
                showTestPanel();
                players = [];
                renderTable();
            }
        }
        
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-message').innerHTML = message;
            document.getElementById('error-message').style.display = 'block';
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        function renderTable() {
            const tbody = document.getElementById('table-body');
            const loading = document.getElementById('loading');
            const table = document.getElementById('rating-table');
            const saveBtn = document.getElementById('save-btn');
            const editModeText = document.getElementById('edit-mode');
            const errorMessage = document.getElementById('error-message');
            const refreshBtn = document.getElementById('refresh-btn');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –æ—à–∏–±–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            loading.style.display = 'none';
            errorMessage.style.display = 'none';
            table.style.display = 'table';
            
            tbody.innerHTML = '';
            
            if (players.length === 0) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 13;
                cell.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                cell.style.textAlign = 'center';
                cell.style.padding = '20px';
                cell.style.color = '#666';
                row.appendChild(cell);
                tbody.appendChild(row);
            } else {
                players.forEach((player, index) => {
                    const row = document.createElement('tr');
                    
                    // –ú–µ—Å—Ç–æ
                    const placeCell = document.createElement('td');
                    placeCell.textContent = player.place || '';
                    if (isEditMode) {
                        placeCell.classList.add('editable', 'add-row');
                        placeCell.onclick = () => editPlace(index);
                    }
                    row.appendChild(placeCell);
                    
                    // –ù–∏–∫
                    const nickCell = document.createElement('td');
                    nickCell.textContent = player.nick || '';
                    if (isEditMode) {
                        nickCell.classList.add('editable');
                        nickCell.onclick = () => editNick(index);
                    }
                    row.appendChild(nickCell);
                    
                    // –ö–æ–ª. –∏–≥—Ä
                    const gamesCell = document.createElement('td');
                    gamesCell.textContent = player.totalGames || 0;
                    row.appendChild(gamesCell);
                    
                    // –†–æ–ª–∏
                    const roles = ['–º–∏—Ä–Ω—ã–π', '–º–∞—Ñ–∏—è', '–¥–æ–Ω', '–ª—é–±–æ–≤–Ω–∏—Ü–∞', '—à–µ—Ä–∏—Ñ', '–¥–æ–∫—Ç–æ—Ä', '–º–∞–Ω—å—è–∫', '–∫–∞–º–∏–∫–∞–¥–∑–µ', '–º—Å—Ç–∏—Ç–µ–ª—å'];
                    roles.forEach(role => {
                        const roleCell = document.createElement('td');
                        const roleData = player[role] || {o: 0, t: 0};
                        roleCell.textContent = `${roleData.o || 0}/${roleData.t || 0}`;
                        if (isEditMode) {
                            roleCell.classList.add('editable');
                            roleCell.onclick = () => editRole(index, role);
                        }
                        row.appendChild(roleCell);
                    });
                    
                    // –û—á–∫–∏
                    const pointsCell = document.createElement('td');
                    pointsCell.textContent = player.totalPoints || 0;
                    row.appendChild(pointsCell);
                    
                    tbody.appendChild(row);
                });
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
            if (isEditMode) {
                saveBtn.style.display = 'block';
                editModeText.textContent = '–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
                editModeText.style.color = '#ff9800';
                updateDebugInfo('–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–µ–Ω');
            } else {
                saveBtn.style.display = 'none';
                editModeText.textContent = '–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä';
                editModeText.style.color = '#666';
                updateDebugInfo('–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞');
            }
            
            // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            refreshBtn.style.display = 'inline-block';
            
            if (!isAdmin) {
                editModeText.textContent = '–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä (–Ω–µ –∞–¥–º–∏–Ω)';
                updateDebugInfo('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞
            updateStatusIndicator();
            
            updateDebugInfo(`‚úÖ –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞: ${players.length} –∏–≥—Ä–æ–∫–æ–≤`);
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏)
        function editPlace(index) {
            updateDebugInfo(`–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ –∏–Ω–¥–µ–∫—Å–∞ ${index}`);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–π
            const newPlayer = {
                place: '',
                nick: '–ù–æ–≤—ã–π –∏–≥—Ä–æ–∫',
                totalGames: 0,
                totalPoints: 0,
                –º–∏—Ä–Ω—ã–π: {o: 0, t: 0},
                –º–∞—Ñ–∏—è: {o: 0, t: 0},
                –¥–æ–Ω: {o: 0, t: 0},
                –ª—é–±–æ–≤–Ω–∏—Ü–∞: {o: 0, t: 0},
                —à–µ—Ä–∏—Ñ: {o: 0, t: 0},
                –¥–æ–∫—Ç–æ—Ä: {o: 0, t: 0},
                –º–∞–Ω—å—è–∫: {o: 0, t: 0},
                –∫–∞–º–∏–∫–∞–¥–∑–µ: {o: 0, t: 0},
                –º—Å—Ç–∏—Ç–µ–ª—å: {o: 0, t: 0}
            };
            
            players.splice(index + 1, 0, newPlayer);
            hasChanges = true;
            updateStatusIndicator();
            updateDebugInfo(`‚úÖ –ù–æ–≤—ã–π –∏–≥—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω. –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${players.length}`);
            renderTable();
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∏–∫–∞
        function editNick(index) {
            currentEdit = { type: 'nick', index: index };
            updateDebugInfo(`‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ ${index}`);
            showModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∏–∫–∞', players[index].nick || '');
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–∏
        function editRole(index, role) {
            currentEdit = { type: 'role', index: index, role: role };
            const roleData = players[index][role] || {o: 0, t: 0};
            updateDebugInfo(`‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ ${role} –¥–ª—è –∏–≥—Ä–æ–∫–∞ ${index}`);
            showModal(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ${role} (–≤–≤–µ–¥–∏—Ç–µ –æ—á–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è)`, '');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function showModal(title, value) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-input').value = value;
            document.getElementById('edit-modal').style.display = 'flex';
            document.getElementById('modal-input').focus();
            updateDebugInfo(`üìã –û—Ç–∫—Ä—ã—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: ${title}`);
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal() {
            document.getElementById('edit-modal').style.display = 'none';
            currentEdit = null;
            updateDebugInfo('üìã –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ');
        }
        
        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function confirmEdit() {
            const value = document.getElementById('modal-input').value.trim();
            updateDebugInfo(`‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${value}`);
            
            if (currentEdit) {
                if (currentEdit.type === 'nick') {
                    players[currentEdit.index].nick = value;
                    updateDebugInfo(`üìù –ù–∏–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${value}`);
                } else if (currentEdit.type === 'role') {
                    // –õ–æ–≥–∏–∫–∞ –¥–ª—è —Ä–æ–ª–µ–π
                    const roleData = players[currentEdit.index][currentEdit.role] || {o: 0, t: 0};
                    
                    if (value === '123') {
                        // –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–≤–µ–¥–µ–Ω–∏—è
                        roleData.o = Math.max(0, roleData.o - (roleData.lastPoints || 0));
                        roleData.t = Math.max(0, roleData.t - 1);
                        updateDebugInfo(`‚Ü©Ô∏è –û—Ç–∫–∞—Ç —Ä–æ–ª–∏ ${currentEdit.role}`);
                    } else {
                        const points = parseInt(value);
                        if (!isNaN(points)) {
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
                            roleData.lastPoints = points;
                            roleData.o = (roleData.o || 0) + points;
                            roleData.t = (roleData.t || 0) + 1;
                            updateDebugInfo(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—á–∫–∏ ${points} –∫ —Ä–æ–ª–∏ ${currentEdit.role}`);
                        } else {
                            updateDebugInfo(`‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—á–∫–∏: ${value}`);
                        }
                    }
                    
                    players[currentEdit.index][currentEdit.role] = roleData;
                }
                
                // –ü–µ—Ä–µ—Å—á–µ—Ç –æ–±—â–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
                recalculatePlayer(currentEdit.index);
                hasChanges = true;
                updateStatusIndicator();
                updateDebugInfo(`üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ`);
            }
            
            closeModal();
            renderTable();
        }
        
        // –ü–µ—Ä–µ—Å—á–µ—Ç –∏–≥—Ä–æ–∫–∞
        function recalculatePlayer(index) {
            const player = players[index];
            let totalGames = 0;
            let totalPoints = 0;
            
            const roles = ['–º–∏—Ä–Ω—ã–π', '–º–∞—Ñ–∏—è', '–¥–æ–Ω', '–ª—é–±–æ–≤–Ω–∏—Ü–∞', '—à–µ—Ä–∏—Ñ', '–¥–æ–∫—Ç–æ—Ä', '–º–∞–Ω—å—è–∫', '–∫–∞–º–∏–∫–∞–¥–∑–µ', '–º—Å—Ç–∏—Ç–µ–ª—å'];
            roles.forEach(role => {
                const roleData = player[role] || {o: 0, t: 0};
                totalGames += roleData.t || 0;
                totalPoints += roleData.o || 0;
            });
            
            player.totalGames = totalGames;
            player.totalPoints = totalPoints;
            updateDebugInfo(`üîÑ –ü–µ—Ä–µ—Å—á–µ—Ç –∏–≥—Ä–æ–∫–∞ ${index}: –∏–≥—Ä—ã=${totalGames}, –æ—á–∫–∏=${totalPoints}`);
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('save-btn').onclick = function() {
            updateDebugInfo('üíæ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            
            if (!hasChanges) {
                updateDebugInfo('‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                showUniversalAlert('–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                return;
            }
            
            // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            showUniversalConfirm('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ', '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è?', function(btnId) {
                updateDebugInfo(`üîî Callback –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–∑–≤–∞–Ω —Å: ${btnId}`);
                
                if (btnId === 'yes') {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
                    const saveBtn = document.getElementById('save-btn');
                    saveBtn.textContent = 'üíæ –°–û–•–†–ê–ù–Ø–ï–ú...';
                    saveBtn.disabled = true;
                    
                    updateDebugInfo('üöÄ –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                    
                    // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
                    updateDebugInfo(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ: ${players.length} –∏–≥—Ä–æ–∫–æ–≤`);
                    console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:', players);
                    
                    if (players.length > 0) {
                        console.log('–ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫:', players[0]);
                        updateDebugInfo(`üë§ –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫: ${players[0].nick} - ${players[0].totalPoints} –æ—á–∫–æ–≤`);
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å tg.sendData
                    if (typeof tg.sendData !== 'function') {
                        updateDebugInfo('‚ùå –û–®–ò–ë–ö–ê: tg.sendData –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω!');
                        console.error('‚ùå tg.sendData –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω!');
                        showUniversalAlert('–û—à–∏–±–∫–∞: sendData –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                        saveBtn.textContent = 'üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø';
                        saveBtn.disabled = false;
                        return;
                    }
                    
                    updateDebugInfo('‚úÖ tg.sendData –¥–æ—Å—Ç—É–ø–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ...');
                    
                    try {
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                        tg.sendData(JSON.stringify(players));
                        updateDebugInfo('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ tg.sendData');
                        
                        // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –∑–µ–ª–µ–Ω—É—é
                        saveBtn.textContent = '‚úÖ –°–û–•–†–ê–ù–ï–ù–û';
                        saveBtn.classList.add('saved');
                        hasChanges = false;
                        updateStatusIndicator();
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                        updateDebugInfo('‚è∞ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã');
                        setTimeout(() => {
                            updateDebugInfo('üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                            forceRefreshData();
                        }, 3000);
                        
                    } catch (error) {
                        updateDebugInfo(`‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${error}`);
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:', error);
                        saveBtn.textContent = 'üíæ –û–®–ò–ë–ö–ê - –ü–û–í–¢–û–†–ò–¢–ï';
                        saveBtn.disabled = false;
                    }
                } else {
                    updateDebugInfo('‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
                }
            });
        };
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        document.getElementById('refresh-btn').onclick = forceRefreshData;
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è ESC –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closeConfirmation(false);
            }
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        updateDebugInfo('üé¨ –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö...');
        checkInitData();
        loadDataFromUrl();
    </script>
</body>
</html>
