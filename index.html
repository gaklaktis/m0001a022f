<script>
// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
function loadDataFromUrl() {
    const params = new URLSearchParams(window.location.search);
    
    let dataUrl = params.get('dataUrl') || 
                 params.get('dataurl') || 
                 params.get('dataURL');
    
    if (dataUrl) {
        const decodedUrl = decodeURIComponent(dataUrl);
        
        // –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
        const random = Math.random().toString(36).substring(7);
        const timestamp = Date.now();
        const urlWithCacheBust = `${decodedUrl}?t=${timestamp}&r=${random}&_=${random}`;
        
        updateDebugInfo(`URL —Å –∞–Ω—Ç–∏-–∫–µ—à–µ–º: ${urlWithCacheBust}`);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
        fetch(urlWithCacheBust, {
            cache: 'no-cache',
            headers: {
                'Cache-Control': 'no-cache, no-store, must-revalidate',
                'Pragma': 'no-cache',
                'Expires': '0'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            updateDebugInfo(`‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ${data.length} –∏–≥—Ä–æ–∫–æ–≤`);
            players = data;
            renderTable();
        })
        .catch(error => {
            updateDebugInfo(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error}`);
            showUniversalAlert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            showTestPanel();
            players = [];
            renderTable();
        });
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
function forceRefreshData() {
    updateDebugInfo('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
    const saveBtn = document.getElementById('save-btn');
    saveBtn.textContent = 'üîÑ –û–ë–ù–û–í–õ–Ø–ï–ú...';
    saveBtn.disabled = true;
    
    loadDataFromUrl();
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        saveBtn.textContent = 'üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø';
        saveBtn.disabled = false;
        saveBtn.classList.remove('saved');
        hasChanges = false;
    }, 2000);
}

// –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
function addRefreshButton() {
    const header = document.querySelector('.header');
    const refreshBtn = document.createElement('button');
    refreshBtn.textContent = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å';
    refreshBtn.style.cssText = `
        background: #2196F3;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        margin-left: 10px;
        font-size: 14px;
    `;
    refreshBtn.onclick = forceRefreshData;
    
    const editModeText = document.getElementById('edit-mode');
    editModeText.parentNode.insertBefore(refreshBtn, editModeText.nextSibling);
}
</script>
